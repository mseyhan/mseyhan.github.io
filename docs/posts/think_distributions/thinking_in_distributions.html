<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Murat Seyhan">
<meta name="description" content="Why does intuition mislead us in complex decisions? We simulate the “dance” of the p-value using 2015–2016 Premier League xG data and talk about power, sample size, and noise.">

<title>Thinking in Distributions in Football – Murat Seyhan, Data Scientist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  (() => {
    const offsetMeta = document.querySelector('meta[name="quarto:offset"]');
    const offset = (offsetMeta?.getAttribute("content") || "").trim();
    const prefix = offset || "./";

    const script = document.createElement("script");
    script.src = `${prefix}assets/lang-toggle.js`;
    document.head.appendChild(script);
  })();
</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Thinking in Distributions in Football – Murat Seyhan, Data Scientist">
<meta property="og:description" content="Why does intuition mislead us in complex decisions? We simulate the “dance” of the p-value using 2015–2016 Premier League xG data and talk about power, sample size, and noise.">
<meta property="og:image" content="/thumbnail.png">
<meta property="og:site_name" content="Murat Seyhan, Data Scientist">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Murat Seyhan, Data Scientist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../#"> 
<span class="menu-text">TR</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mseyhan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/muratseyhan"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/false9ry"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Thinking in Distributions in Football</h1>
                  <div>
        <div class="description">
          Why does intuition mislead us in complex decisions? We simulate the “dance” of the p-value using 2015–2016 Premier League xG data and talk about power, sample size, and noise.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Football Analytics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Murat Seyhan </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-experiment-well-run-asking-the-same-question-thousands-of-times" id="toc-the-experiment-well-run-asking-the-same-question-thousands-of-times" class="nav-link" data-scroll-target="#the-experiment-well-run-asking-the-same-question-thousands-of-times">The experiment we’ll run: asking the same question thousands of times</a></li>
  <li><a href="#pulling-the-data-and-preprocessing" id="toc-pulling-the-data-and-preprocessing" class="nav-link" data-scroll-target="#pulling-the-data-and-preprocessing">Pulling the data and preprocessing</a></li>
  <li><a href="#simulating-the-true-difference-and-zero-difference-worlds" id="toc-simulating-the-true-difference-and-zero-difference-worlds" class="nav-link" data-scroll-target="#simulating-the-true-difference-and-zero-difference-worlds">Simulating the “true difference” and “zero difference” worlds</a></li>
  <li><a href="#why-do-p-values-look-like-a-flat-line-in-the-h0-world" id="toc-why-do-p-values-look-like-a-flat-line-in-the-h0-world" class="nav-link" data-scroll-target="#why-do-p-values-look-like-a-flat-line-in-the-h0-world">Why do p-values look like a “flat line” in the H0 world?</a></li>
  <li><a href="#the-h1-world-if-there-is-a-true-difference-ps-pile-up-on-the-left-but-can-still-come-out-large" id="toc-the-h1-world-if-there-is-a-true-difference-ps-pile-up-on-the-left-but-can-still-come-out-large" class="nav-link" data-scroll-target="#the-h1-world-if-there-is-a-true-difference-ps-pile-up-on-the-left-but-can-still-come-out-large">The H1 world: if there is a true difference, p’s pile up on the left, but can still come out large</a></li>
  <li><a href="#power-the-left-of-the-alpha-line-in-the-histogram" id="toc-power-the-left-of-the-alpha-line-in-the-histogram" class="nav-link" data-scroll-target="#power-the-left-of-the-alpha-line-in-the-histogram">Power: the “left of the alpha line” in the histogram</a></li>
  <li><a href="#where-do-we-make-the-wrong-decisions" id="toc-where-do-we-make-the-wrong-decisions" class="nav-link" data-scroll-target="#where-do-we-make-the-wrong-decisions">Where do we make the wrong decisions?</a>
  <ul class="collapse">
  <li><a href="#we-do-character-analysis-off-a-single-big-match" id="toc-we-do-character-analysis-off-a-single-big-match" class="nav-link" data-scroll-target="#we-do-character-analysis-off-a-single-big-match">- We do character analysis off a single big match</a></li>
  <li><a href="#we-get-overly-attached-to-the-score-or-results" id="toc-we-get-overly-attached-to-the-score-or-results" class="nav-link" data-scroll-target="#we-get-overly-attached-to-the-score-or-results">- We get overly attached to the score or results</a></li>
  <li><a href="#we-make-expensive-decisions-off-a-short-run" id="toc-we-make-expensive-decisions-off-a-short-run" class="nav-link" data-scroll-target="#we-make-expensive-decisions-off-a-short-run">- We make expensive decisions off a short run</a></li>
  </ul></li>
  <li><a href="#how-does-this-help-us-make-better-decisions" id="toc-how-does-this-help-us-make-better-decisions" class="nav-link" data-scroll-target="#how-does-this-help-us-make-better-decisions">How does this help us make better decisions?</a>
  <ul class="collapse">
  <li><a href="#quit-the-habit-of-deciding-with-a-tiny-sample-15-decision-points" id="toc-quit-the-habit-of-deciding-with-a-tiny-sample-15-decision-points" class="nav-link" data-scroll-target="#quit-the-habit-of-deciding-with-a-tiny-sample-15-decision-points">- Quit the habit of deciding with a tiny sample <em>(1–5 decision points)</em></a></li>
  <li><a href="#raise-the-evidence-threshold-for-expensive-decisions" id="toc-raise-the-evidence-threshold-for-expensive-decisions" class="nav-link" data-scroll-target="#raise-the-evidence-threshold-for-expensive-decisions">- Raise the evidence threshold for expensive decisions</a></li>
  <li><a href="#try-to-use-process-metrics-instead-of-outcome-metrics" id="toc-try-to-use-process-metrics-instead-of-outcome-metrics" class="nav-link" data-scroll-target="#try-to-use-process-metrics-instead-of-outcome-metrics">- Try to use process metrics instead of outcome metrics</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>I’ve been kind of obsessed with decision-making for a while. I think human intuition, by its nature, is weak when it comes to making decisions in high-dimensional problems. Even if we can make “primitive” decisions very comfortably, in complex problems our intuitive decision-making isn’t that different from random choices. The environment matters a lot here, too. If we work in an area where our actions produce highly regular and fast feedback, then we can trust our intuition more.</p>
<p>There’s no complete cure for biases and mental shortcuts; we’re all vulnerable to them. But by building certain habits, we can still pave the way to making better decisions overall. Most of the times I felt like I got better at decision-making were the times I acted by <em>not</em> trusting my intuition on many things. While picking up new habits, I tried to lean on statistical ways of thinking. I’m also aware I still have a long way to go.</p>
<p>And like everyone else, as I walk this road, I understand what I’m working on more easily through examples from daily life. That’s why, in what I write, I often try to use context discovery and analogy. It’s useful to map the decisions I make in different areas of my life onto what I’ve learned. And for the next decision, I try to make each new way of thinking more “native” to me. Being able to develop skills that transfer across contexts matters.</p>
<p>The observation bank I’ve built from working in data analytics for about 5 years pushed me to question some of the intuitive choices that are used a lot in the field. The topic I sat down to write about in this blog is one of those widely used “rules of thumb”: the “p-value”.</p>
<hr>
<p>The most basic problem with the p-value is this: most of the time we use it as <strong><em>“a one-shot decision label”</em></strong>. But even though the p-value lands in our hands as a single number, it carries <strong>variability</strong> behind it; even under the same true effect, if you measure again and again with different samples, sometimes p comes out small, sometimes large. In the <a href="https://mseyhan.github.io/tr/posts/regression_mean/regression_to_the_mean.html"><em>previous post</em></a>, when I said “extremes mislead”, what I meant was treating a single observation as the whole universe. Here we’ll carry the same idea to a different place: <strong>a single p doesn’t have to represent reality</strong>. Sometimes, just with bad luck, it looks “insignificant”; sometimes, with good luck, it looks “very significant”. So the p-value kind of <a href="https://www.youtube.com/watch?v=5OL1RqHrZQ8"><em>dances</em></a>. And from what I can see, this concept—now a very common one in data analytics—often gets used as a one-shot decision label by ignoring its dance.</p>
<p>In this post, to make things more intuitive and easier to understand, I’ll let the reader watch two separate “universes”; think of it as if the same movie has two different versions.</p>
<p>In the first universe, there is the <strong>H0 world</strong>: in reality there is no difference between two things, meaning there is no signal to catch.</p>
<p>In the second universe, there is the <strong>H1 world</strong>: in reality there <em>is</em> a difference, but because of signal strength and the level of noise, it doesn’t show up with the same clarity in every measurement.</p>
<p>The same p-value idea behaves very differently in these two worlds: in one, false alarms are “natural”; in the other, even though there is a real signal, it’s “normal” that sometimes the alarm doesn’t ring. When I put these two universes side by side, I started reading the p-value not as a result stamp, but as <strong>a frequency idea that helps us tune our intuitive decisions</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Notes on the method and which data we’ll use">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Notes on the method and which data we’ll use
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>At this point I don’t want to leave the abstract concepts hanging in the air; because my whole point is already this “intuitive decision” thing. In real life, when we make decisions, most of the time we don’t have a single experiment in our hands—there are lots of small observations, an uncertain signal, and noisy results. Football is a perfect lab in this sense: first, everyone has an opinion :), the data is abundant, but decisions (player form, transfers, coaching changes) are often made by leaning on single matches or short runs. So football data is a good ground for showing how “single numbers” like the p-value can mislead us.</p>
<p>While showing this, I wanted to use real football data. StatsBomb’s Open Data set openly shares event-level data for some leagues and tournaments. This whole blog will be a sanity-check of an idea that can be reproduced easily, and I’ll use the <strong>Premier League 2015–16 season</strong>. The story of that season is extremely strong (Leicester’s title), and because I followed it live back then, the context is still vivid in my head. Instead of abstract A/B examples, I think it’s easier to place what we’re trying to measure into a world everyone can picture.</p>
<p>Technically, in Python we connect to Open Data with <code>statsbombpy</code> and pull the season’s matches; then we take the shots from each match’s event data and use the expected goals value per shot (<code>shot_statsbomb_xg</code>). As you know, this metric is both a common reference point in modern football and, because it’s closer to a process measure than the outcome (goal/no goal), it reduces noise. In the simulations you’ll see later, we’ll use this shot-xG distribution and pretend we’re asking the same question again and again: <em>“Is the average shot quality of these two groups really different?”</em> That’s where the p-value’s dance becomes much more visible on this noisy sample coming from real football.</p>
</div>
</div>
</div>
<hr>
</section>
<section id="the-experiment-well-run-asking-the-same-question-thousands-of-times" class="level3">
<h3 class="anchored" data-anchor-id="the-experiment-well-run-asking-the-same-question-thousands-of-times">The experiment we’ll run: asking the same question thousands of times</h3>
<p>Of course we’re not going to leave the “p-value dances” line as an abstract claim. We’ll <strong>pretend we’re repeating the same comparison thousands of times</strong> and actually look at the shape of the p-values.</p>
<p>For that, I’m choosing two groups where it’s reasonable to expect a difference:</p>
<ul>
<li><strong>Attacker</strong>: positions like striker, winger—roles that do more finishing</li>
<li><strong>Defender</strong>: center back/full back—more defense-oriented positions</li>
</ul>
<p>The reason I’m picking this pair is simple: xG per shot (shot quality) is strongly related to role and position. You’d expect attackers to take shots more often from regions considered more “dangerous”; defenders’ shots can be rarer and lower-quality. Kompany might have felt amazing when he took <a href="https://www.youtube.com/watch?v=Q37w_Da4dPA"><em>that shot</em></a> and struck it cleanly, but the chance of it becoming a goal was still low.. :) Overall, this grouping gives us a reasonable “true difference” hypothesis for our H1 world.</p>
<p>We’ll construct the H0 world like this: <strong>as if there is no difference in reality</strong>, we’ll generate the two groups from the same pool. To do that, we collect all players’ shots into a single pool, then split them into two groups via random selection. That way, both groups’ average shot quality truly comes from the same distribution.</p>
</section>
<section id="pulling-the-data-and-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="pulling-the-data-and-preprocessing">Pulling the data and preprocessing</h3>
<p>The cells below select the Premier League 2015–16 season from StatsBomb Open Data and pull the event data for all matches, then keep only the shots and collect the <code>shot_statsbomb_xg</code> field.</p>
<div id="a6737372" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>comps <span class="op">=</span> sb.competitions()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>competition_id <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>season_id      <span class="op">=</span> <span class="dv">27</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>matches <span class="op">=</span> sb.matches(competition_id<span class="op">=</span>competition_id, season_id<span class="op">=</span>season_id)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>match_ids <span class="op">=</span> matches[<span class="st">"match_id"</span>].tolist()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next up: take the shots from all matches and split them into two groups. My goal here isn’t to create a “perfect position classification”; it’s to create <strong>two reasonable categories that match our intuition</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Code: Pulling event data and preprocessing">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Code: Pulling event data and preprocessing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>KEEP_COLS <span class="op">=</span> [</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"match_id"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"position"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shot_statsbomb_xg"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"team"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"player_id"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"under_pressure"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>shots_list <span class="op">=</span> []</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mid <span class="kw">in</span> match_ids:</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> sb.events(match_id<span class="op">=</span>mid)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"Shot"</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> KEEP_COLS <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[cols]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">"shot_statsbomb_xg"</span>, <span class="st">"position"</span>])</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    shots_list.append(df)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> pd.concat(shots_list, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">"position"</span>, <span class="st">"team"</span>]:</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="kw">in</span> shots.columns:</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        shots[c] <span class="op">=</span> shots[c].astype(<span class="st">"category"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"shot_statsbomb_xg"</span>] <span class="op">=</span> shots[<span class="st">"shot_statsbomb_xg"</span>].astype(<span class="st">"float32"</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>shots[<span class="st">"pos_group"</span>] <span class="op">=</span> np.where(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    shots[<span class="st">"position"</span>].<span class="bu">str</span>.contains(<span class="st">"Forward|Striker|Winger"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Attacker"</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    np.where(shots[<span class="st">"position"</span>].<span class="bu">str</span>.contains(<span class="st">"Back|Defender"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>), <span class="st">"Defender"</span>, <span class="st">"Other"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>shots <span class="op">=</span> shots[shots[<span class="st">"pos_group"</span>].isin([<span class="st">"Attacker"</span>, <span class="st">"Defender"</span>])]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>As you can see below, there are enough shots in the season data.</p>
<div id="b7bbeaac" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(shots)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>4286</code></pre>
</div>
</div>
</section>
<section id="simulating-the-true-difference-and-zero-difference-worlds" class="level3">
<h3 class="anchored" data-anchor-id="simulating-the-true-difference-and-zero-difference-worlds">Simulating the “true difference” and “zero difference” worlds</h3>
<p>The key idea here is this: a p-value isn’t a one-off result; because what it tells us is <strong>how likely the mean from our sample is, under the assumption that the null hypothesis is true</strong>. Our sample could have been totally different, because we made a random selection. So p-values necessarily have a distribution, and that distribution changes with sample size. We’ll “animate” this distribution by repeating the same experiment 20,000 times with the help of the law of large numbers.</p>
<ul>
<li><strong>H1-like simulation (there is a real difference):</strong> we sample separately from the Attacker and Defender groups; on each repetition we compare the two means and compute p.</li>
<li><strong>H0-like simulation (there is no real difference):</strong> we assume both groups come from the same pool and draw two samples from a single pool; again we compute p.</li>
</ul>
<div id="ab3b2982" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># H1: two groups come from different pools.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_pvals(df, group_col, value_col, g1, g2, n<span class="op">=</span><span class="dv">100</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> df[df[group_col] <span class="op">==</span> g1][value_col].to_numpy()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df[df[group_col] <span class="op">==</span> g2][value_col].to_numpy()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.empty(B)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(B):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        xs <span class="op">=</span> rng.choice(x, size<span class="op">=</span>n, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        ys <span class="op">=</span> rng.choice(y, size<span class="op">=</span>n, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        p[i] <span class="op">=</span> stats.ttest_ind(xs, ys, equal_var<span class="op">=</span><span class="va">False</span>).pvalue</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: two groups come from the same pool.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_pvals_null_by_permutation(df, group_col, value_col, g1, g2, n<span class="op">=</span><span class="dv">100</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df[df[group_col].isin([g1, g2])][[group_col, value_col]].dropna().copy()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> sub[value_col].to_numpy()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.empty(B)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(B):</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        xs <span class="op">=</span> rng.choice(vals, size<span class="op">=</span>n, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        ys <span class="op">=</span> rng.choice(vals, size<span class="op">=</span>n, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        p[i] <span class="op">=</span> stats.ttest_ind(xs, ys, equal_var<span class="op">=</span><span class="va">False</span>).pvalue</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>When I pick a value like <code>n=50</code> here, what I’m really doing is this: “In each universe, it’s as if I take <strong>two mini-samples of 50 shots</strong> (Attacker vs Defender) and check whether there’s a difference between them.” This maps almost perfectly to the “judging from a single match” feeling in football: <strong>small sample size</strong>.</p>
</section>
<section id="why-do-p-values-look-like-a-flat-line-in-the-h0-world" class="level3">
<h3 class="anchored" data-anchor-id="why-do-p-values-look-like-a-flat-line-in-the-h0-world">Why do p-values look like a “flat line” in the H0 world?</h3>
<p>In the H0 world, there is no real difference. So producing p-values is basically like producing numbers <strong>spread uniformly between 0 and 1</strong>. 0.08 and 0.98 are equally ordinary.</p>
<p>Let’s see this not just as words, but directly through outputs taken from the data.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Code: Histogram function">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Code: Histogram function
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_hist(p, title<span class="op">=</span><span class="st">""</span>, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.05</span>, density<span class="op">=</span><span class="va">False</span>, show_expected<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> np.asarray(p, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p[np.isfinite(p)]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p[(p <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (p <span class="op">&lt;=</span> <span class="dv">1</span>)]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    frac_sig <span class="op">=</span> (p <span class="op">&lt;</span> alpha).mean()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="fl">8.5</span>, <span class="fl">4.8</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    edges <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, bins <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ax.hist(p, bins<span class="op">=</span>edges, density<span class="op">=</span>density)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ax.axvline(alpha, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_expected:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> density:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            ax.axhline(<span class="fl">1.0</span>, linestyle<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            expected <span class="op">=</span> p.size <span class="op">/</span> bins</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            ax.axhline(expected, linestyle<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    main_title <span class="op">=</span> title.strip() <span class="cf">if</span> title <span class="cf">else</span> <span class="st">"p-value distribution"</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>main_title<span class="sc">}</span><span class="ss"> | n=</span><span class="sc">{</span>p<span class="sc">.</span>size<span class="sc">:,}</span><span class="ss"> | P(p&lt;</span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">)=</span><span class="sc">{</span>frac_sig<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"p-value"</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"density"</span> <span class="cf">if</span> density <span class="cf">else</span> <span class="st">"count"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">"major"</span>, axis<span class="op">=</span><span class="st">"both"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> spine <span class="kw">in</span> [<span class="st">"top"</span>, <span class="st">"right"</span>]:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        ax.spines[spine].set_visible(<span class="va">False</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>The chart below shows the p-value distribution from a simulation run 20,000 times in the H0 world. As you can see, the p-values are distributed almost evenly between 0 and 1.</p>
<div id="a01bed9e" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p_h0 <span class="op">=</span> simulate_pvals_null_by_permutation(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    shots, <span class="st">"pos_group"</span>, <span class="st">"shot_statsbomb_xg"</span>, <span class="st">"Attacker"</span>, <span class="st">"Defender"</span>, n<span class="op">=</span><span class="dv">50</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">1903</span> <span class="co"># bjk</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"H0-like P(p&lt;0.05):"</span>, (p_h0 <span class="op">&lt;</span> <span class="fl">0.05</span>).mean())</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plot_hist(p_h0, <span class="st">"H0-like: pooled null (should look ~uniform)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>H0-like P(p&lt;0.05): 0.04755</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="thinking_in_distributions_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>In the H0 world, a small p isn’t “bad”; it’s just the inevitable cost of false alarms.</strong> If you picked the threshold as 0.05, then even when there is no real difference, in the long run you’ve already accepted that you’ll see p&lt;0.05 in about 5 out of every 100 trials. So even if the null hypothesis is true and there’s no effect, in 5 out of 100 experiments we’ll mistakenly conclude “there is a significant difference”—and we set that threshold ourselves.</p>
</section>
<section id="the-h1-world-if-there-is-a-true-difference-ps-pile-up-on-the-left-but-can-still-come-out-large" class="level3">
<h3 class="anchored" data-anchor-id="the-h1-world-if-there-is-a-true-difference-ps-pile-up-on-the-left-but-can-still-come-out-large">The H1 world: if there is a true difference, p’s pile up on the left, but can still come out large</h3>
<p>In this universe, because we treat Attacker and Defender as genuinely separate pools, if our a priori hunch is right, the means will tend to separate, and the p-values will start piling up toward 0.</p>
<p>But the everyday intuition of “if p&lt;0.05 then there is an effect” is wrong, and unless we keep the p-value distribution in our head, we might not realize it. Intuitively, the first thing that comes to mind is that the number we see is definitive proof that the effect exists. In real life, though—especially with small samples—sometimes p can come out large, too. Think of flipping a coin. Even if the coin is slightly rigged, in 10 flips it can sometimes look perfectly fair.</p>
<p>The football version is very familiar. Even if a striker is truly a good finisher, <strong>in a single match</strong> he can miss two clear chances. Or, since referees are a frequent topic: even if they were practically making meaningfully biased decisions, looking at just 1–2 matches we still might not be able to call it—we could also see it as if they’re officiating very fairly.</p>
<div id="41c1d687" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p_h1 <span class="op">=</span> simulate_pvals(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    shots, <span class="st">"pos_group"</span>, <span class="st">"shot_statsbomb_xg"</span>, <span class="st">"Attacker"</span>, <span class="st">"Defender"</span>, n<span class="op">=</span><span class="dv">50</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">1903</span> <span class="co"># bjk</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"H1-like P(p&lt;0.05):"</span>, (p_h1 <span class="op">&lt;</span> <span class="fl">0.05</span>).mean())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plot_hist(p_h1, <span class="st">"H1-like: Attacker vs Defender (should pile up near 0)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>H1-like P(p&lt;0.05): 0.5935</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="thinking_in_distributions_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The first thing that jumps out in the chart is, naturally, the left skew. But we can still see bars on the right side.</p>
<p>That’s why we need to start perceiving p not as a single outcome, but as <strong>something with a shape—a distribution</strong>. Having p’s that fall on the right tells us this:</p>
<blockquote class="blockquote">
<p><em>Even when there is an effect, “non-significant” results are sometimes expected; what decides this is the power of the sample and the level of noise.</em></p>
</blockquote>
<p>Now let’s make power something we can talk about on top of these histograms: <em>“P(p&lt;0.05)”</em> is basically the quantified version of how often we expect the alarm to ring in each universe.</p>
<hr>
</section>
<section id="power-the-left-of-the-alpha-line-in-the-histogram" class="level3">
<h3 class="anchored" data-anchor-id="power-the-left-of-the-alpha-line-in-the-histogram">Power: the “left of the alpha line” in the histogram</h3>
<p>When plotting the histograms, I deliberately added the dashed vertical line at 0.05 (alpha). Because that line is the boundary where we say: “if it falls below this threshold, <strong>I’ll raise the alarm</strong>”.</p>
<p>In fact, what we call <strong>power</strong> is the area that stays to the left of this line in the H1 world:</p>
<blockquote class="blockquote">
<p><strong>Power = P(p &lt; α | H1 true)</strong></p>
</blockquote>
<p>Let’s not treat this as some complicated thing; it’s just saying this:</p>
<blockquote class="blockquote">
<p>If there is a real difference, and I repeated the same experiment over and over, in how many of them would I see “p&lt;0.05” and say <em>“ok, there’s a signal”</em>?</p>
</blockquote>
<p>The <code>P(p&lt;0.05)=...</code> text in the chart title is exactly “the share left of the alpha line”.</p>
<ul>
<li>In the H0 chart (the uniform one), this comes out around <strong>0.05</strong>: because when there is no signal, the threshold itself determines the false-alarm rate.</li>
<li>In the H1 chart (the left-piled one), this number becomes <strong>power</strong>: how often the alarm rings when there is a real difference.</li>
</ul>
<p>If power is 50%, then if we ran the same comparison 100,000 times, we’d see <code>p&lt;0.05</code> in about 50,000 of them. The kind of sentence we mentioned at the beginning—“p didn’t come out today → there is no effect”—often skips this: maybe the power of this experiment is low, meaning you should expect to see a “silent alarm” frequently <strong>even when there is an effect</strong>.</p>
<p>When we say <code>n=50</code>, we’re basically taking a “mini-sample of 50 shots from each group”. In some matches/series you can’t even collect 50 shots; as the sample gets smaller, noise grows and power drops. Result: even if there is a real difference, p can sometimes stay on the right side.</p>
<p>In the next step, we’ll show the intuition <strong>from the other direction</strong>: “if you increase n, power increases” is true, but one of the best ways to feel it is to <strong>shrink n</strong> and see what you lose.</p>
<p>In the previous chart, with <code>n=50</code> (mini-samples of 50 shots per group), we saw that p’s pile up clearly on the left. Now let’s do the same thing with a smaller sample size: <strong>n=5</strong>. Each time, we’ll take 5 shots from attackers and 5 shots from defenders and test. Especially for attackers, this can be even harsher than “judging from one match”. A striker can easily take more than 5 shots in a match. It’s like passing judgment before the match even ends.</p>
<p>In the chart below, in the H1 world, we’ll see:</p>
<ol type="1">
<li><p>The part left of the <strong>alpha line</strong> (0.05) will shrink — meaning the <code>P(p&lt;0.05)</code> in the title will drop.</p></li>
<li><p>The “stuck to the left” feeling will weaken; p’s will spread more to the right.</p></li>
</ol>
<div id="8f3f86e4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p_h1 <span class="op">=</span> simulate_pvals(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    shots, <span class="st">"pos_group"</span>, <span class="st">"shot_statsbomb_xg"</span>, <span class="st">"Attacker"</span>, <span class="st">"Defender"</span>, n<span class="op">=</span><span class="dv">5</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">1903</span> <span class="co"># bjk</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># leave H0 the same way: so our reference line (uniformity) doesn't change</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>p_h0 <span class="op">=</span> simulate_pvals_null_by_permutation(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    shots, <span class="st">"pos_group"</span>, <span class="st">"shot_statsbomb_xg"</span>, <span class="st">"Attacker"</span>, <span class="st">"Defender"</span>, n<span class="op">=</span><span class="dv">50</span>, B<span class="op">=</span><span class="dv">20000</span>, seed<span class="op">=</span><span class="dv">1903</span> <span class="co"># bjk</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"H1-like P(p&lt;0.05):"</span>, (p_h1 <span class="op">&lt;</span> <span class="fl">0.05</span>).mean())</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"H0-like P(p&lt;0.05):"</span>, (p_h0 <span class="op">&lt;</span> <span class="fl">0.05</span>).mean())</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plot_hist(p_h0, <span class="st">"H0-like: pooled null (should look ~uniform)"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plot_hist(p_h1, <span class="st">"H1-like: Attacker vs Defender (less piling up near 0)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>H1-like P(p&lt;0.05): 0.03405
H0-like P(p&lt;0.05): 0.04755</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="thinking_in_distributions_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="thinking_in_distributions_files/figure-html/cell-10-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I think the message here is very clear: <strong>even when there is a real difference</strong>, if all you have each time is 5 shots per group, expecting a “significant result” is not realistic.</p>
<p>The decisions we make with low sample sizes often come not from “there is no reality there”, but from <strong>not being able to see it</strong>. You can also see from here how harmful it can be that we’re so ready—fan or board member, doesn’t matter—to make big statements about player form, team chemistry, or a coach’s impact based on a single match.</p>
<hr>
</section>
<section id="where-do-we-make-the-wrong-decisions" class="level2">
<h2 class="anchored" data-anchor-id="where-do-we-make-the-wrong-decisions">Where do we make the wrong decisions?</h2>
<p>Put simply: <strong>we treat a single sample as if it were the distribution.</strong></p>
<p>Maybe p-value isn’t a concept we use in daily life a lot, but every time we “detect” a difference or an effect in our head, we’re basically running a p-value-like process. We think what we saw is different from normal, and we kick off a test in our mind according to our norms. <strong>If the difference looks big to us, and it sits farther from the general deviation of the norms around us, we call it “significant”.</strong> But usually this comes from a single or just a handful of observations.</p>
<p>When I started seeing the p-value not as a “single outcome” but as “the output of a repeatable process”, I began thinking that most of the time we’re just overreacting to noise randomly showing up in front of us. Yet we use it as the basis for character analysis, form diagnosis, even million-euro decisions.</p>
<p>I think there are common pattern mistakes we fall into, for example:</p>
<section id="we-do-character-analysis-off-a-single-big-match" class="level3">
<h3 class="anchored" data-anchor-id="we-do-character-analysis-off-a-single-big-match">- We do character analysis off a single big match</h3>
<pre class="text"><code>He managed the derby badly, we lost. → “He’s not a big-match coach.”</code></pre>
<p>This is a problematic read because “derby performance” contains a ton of randomness inside it. An early conceded goal, a referee decision, one or two critical turnovers… Instead of measuring someone’s true level, we take a single draw from the distribution (that day’s realization) and do a personality analysis.</p>
</section>
<section id="we-get-overly-attached-to-the-score-or-results" class="level3">
<h3 class="anchored" data-anchor-id="we-get-overly-attached-to-the-score-or-results">- We get overly attached to the score or results</h3>
<pre class="text"><code>He scored 2 goals → “in form.”</code></pre>
<p>Goals are one of the noisiest outputs in football. But most of the time we worship the outcome and ignore the process: where the shot came from, shot quality (xG), the player’s role, the context in which the team gets him into that position… We used xG (<code>shot_statsbomb_xg</code>) for exactly this reason: it’s a good example of a process metric that’s closer to the shot’s “danger” level, independent of whether it turned into a goal.</p>
</section>
<section id="we-make-expensive-decisions-off-a-short-run" class="level3">
<h3 class="anchored" data-anchor-id="we-make-expensive-decisions-off-a-short-run">- We make expensive decisions off a short run</h3>
<pre class="text"><code>10–15 matches → “sell / loan / sack the coach.”</code></pre>
<p>This means making expensive decisions, in the context we described above, with a <em>“low-power measurement”</em>. In the Süper Lig, sometimes you see a coaching change every 10 matches. A 10-match run is a tiny window inside football’s noise. What we see here is often not true performance, but deviations coming from randomness.</p>
<p>For example, <a href="https://x.com/BozzStatz">BozzStats</a> has a visualization that always makes me laugh.</p>
<p><a href="https://hocam.bozzstatz.com/">BozzStats “Hocam” Chart</a></p>
</section>
</section>
<section id="how-does-this-help-us-make-better-decisions" class="level2">
<h2 class="anchored" data-anchor-id="how-does-this-help-us-make-better-decisions">How does this help us make better decisions?</h2>
<p>Like I mentioned before, trying to develop skills that transfer across contexts is really important. We can use this idea while building small reflexes to make better decisions.</p>
<section id="quit-the-habit-of-deciding-with-a-tiny-sample-15-decision-points" class="level3">
<h3 class="anchored" data-anchor-id="quit-the-habit-of-deciding-with-a-tiny-sample-15-decision-points">- Quit the habit of deciding with a tiny sample <em>(1–5 decision points)</em></h3>
<p>Instead of passing judgment from a single match, build the habit of slowing yourself down with: “In what kind of series am I seeing this performance?” Questions to think with:</p>
<ul>
<li>Is the same player making similar decisions in similar roles, against similar opponents?</li>
<li>Did the conditions change? (role, injury, tactics, match flow)</li>
</ul>
<p>In p-value language, this means: <strong>don’t decide with a single p; look for repeatability in the process.</strong></p>
</section>
<section id="raise-the-evidence-threshold-for-expensive-decisions" class="level3">
<h3 class="anchored" data-anchor-id="raise-the-evidence-threshold-for-expensive-decisions">- Raise the evidence threshold for expensive decisions</h3>
<p>As the cost of a decision goes up, you should raise your “evidence” threshold too.</p>
<ul>
<li>Decisions like sacking a coach / selling a player / giving a big contract shouldn’t be made off a one-match feeling, but with a stronger signal and a more solid sample.</li>
</ul>
<p>You can do this by keeping the <code>n=5</code> experiment in the notebook in mind. When the sample shrinks, power drops, and it becomes harder to see a clear result “even when there is an effect”. For expensive decisions, that’s not a risk we want to take.</p>
</section>
<section id="try-to-use-process-metrics-instead-of-outcome-metrics" class="level3">
<h3 class="anchored" data-anchor-id="try-to-use-process-metrics-instead-of-outcome-metrics">- Try to use process metrics instead of outcome metrics</h3>
<p>Instead of making decisions with outcome metrics like goals/points, process metrics (xG, shot quality, passing connections, pressing actions, carrying the ball into the final third, etc.) can give more stable signals.</p>
<p>In general, focusing on improving the process and waiting for the results to follow can be healthier than getting overly attached to single outcomes.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>